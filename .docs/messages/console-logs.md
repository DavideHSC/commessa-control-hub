dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '80',
[dev:server]   codiceFiscale: 'SCRGPP70L25L845Z',
[dev:server]   codiceAnagrafica: 'SCARPATI GIU',
[dev:server]   denominazione: 'SCARPATI GIUSEPPE',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '81',
[dev:server]   codiceFiscale: '03555681216',
[dev:server]   codiceAnagrafica: '002973',
[dev:server]   denominazione: 'IL MELOGRANO ONLUS',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '82',
[dev:server]   codiceFiscale: '05403151003',
[dev:server]   codiceAnagrafica: 'TRENITALIA',
[dev:server]   denominazione: 'TRENITALIA SPA',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '83',
[dev:server]   codiceFiscale: '05986200631',
[dev:server]   codiceAnagrafica: 'STAM.PETAGNA',
[dev:server]   denominazione: 'STAMPERIA GRAFICA A. PETAGNA DI PETAGNA G. & C. SNC',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '84',
[dev:server]   codiceFiscale: '03712950637',
[dev:server]   codiceAnagrafica: 'SURRENTUM S.',
[dev:server]   denominazione: 'SURRENTUM S.A.S. DI RUSSO MARIANO, FIORENTINO LUISA E C.',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '85',
[dev:server]   codiceFiscale: '00275070639',
[dev:server]   codiceAnagrafica: 'HOTELCONTINE',
[dev:server]   denominazione: 'HOTEL CONTINENTAL S.R.L.',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '86',
[dev:server]   codiceFiscale: '06059180635',
[dev:server]   codiceAnagrafica: 'EUROGRAF',
[dev:server]   denominazione: 'EUROGRAF DI G.IZZO & A. FONTANA SNC',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '87',
[dev:server]   codiceFiscale: '05833060634',
[dev:server]   codiceAnagrafica: 'ECOLAB',
[dev:server]   denominazione: 'LABORATORI DI RICERCHE CLINICHE DR. ALESSANDR',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '88',
[dev:server]   codiceFiscale: 'VSTGNN54L13F839C',
[dev:server]   codiceAnagrafica: '003855',
[dev:server]   denominazione: 'VISETTI GIOVANNI',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '89',
[dev:server]   codiceFiscale: '03954400630',
[dev:server]   codiceAnagrafica: 'MEANS SAS',
[dev:server]   denominazione: 'M.E.A.N.S. SAS',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '9',
[dev:server]   codiceFiscale: 'CCRGNN47R05F162D',
[dev:server]   codiceAnagrafica: 'MED14',
[dev:server]   denominazione: 'IACCARINO GIOVANNI',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '90',
[dev:server]   codiceFiscale: '06244640634',
[dev:server]   codiceAnagrafica: 'PIANO MOTORI',
[dev:server]   denominazione: 'PIANO MOTORI S.R.L.',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '91',
[dev:server]   codiceFiscale: '05215560631',
[dev:server]   codiceAnagrafica: 'EDILTRASPORT',
[dev:server]   denominazione: 'EDILTRASPORTI 2000 S.R.L.',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '92',
[dev:server]   codiceFiscale: '03326581216',
[dev:server]   codiceAnagrafica: 'CURRERI',
[dev:server]   denominazione: 'AUTOLINEE CURRERI S.R.L.',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '93',
[dev:server]   codiceFiscale: '01821050638',
[dev:server]   codiceAnagrafica: 'MORMILE',
[dev:server]   denominazione: 'MORMILE S.R.L.',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '94',
[dev:server]   codiceFiscale: 'GRGNNN60E08I862S',
[dev:server]   codiceAnagrafica: '004101',
[dev:server]   denominazione: 'G.A. ELETTROIMPIANTI DI GARGIULO ANTONINO',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '95',
[dev:server]   codiceFiscale: '04644221212',
[dev:server]   codiceAnagrafica: '004210',
[dev:server]   denominazione: 'IL ROSETO DI RUOCCO A',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '96',
[dev:server]   codiceFiscale: 'LRAGPP66D24I208N',
[dev:server]   codiceAnagrafica: 'LAURO COSTR.',
[dev:server]   denominazione: 'LAURO COSTRUZIONI DI LAURO GIUSEPPE',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '97',
[dev:server]   codiceFiscale: '03389201215',
[dev:server]   codiceAnagrafica: 'EDILTECH',
[dev:server]   denominazione: 'EDILTECH  SNC',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '98',
[dev:server]   codiceFiscale: '03189681210',
[dev:server]   codiceAnagrafica: 'STINCA',
[dev:server]   denominazione: 'CANTINE STINCA S.A.S. DI STINCA ANIELLO E C.',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] 🔍 DEBUG Parsed data: {
[dev:server]   codiceUnivoco: '99',
[dev:server]   codiceFiscale: '00309310605',
[dev:server]   codiceAnagrafica: 'ENERGAS',
[dev:server]   denominazione: 'ENERGAS S.P.A.',
[dev:server]   tipoConto: 'F'
[dev:server] }
[dev:server] ✅ Trasformazione completata:
[dev:server]    - Clienti da creare: 52
[dev:server]    - Fornitori da creare: 487
[dev:server]    - Record "Entrambi": 13
[dev:server]    - Persone fisiche: 115
[dev:server]    - Società: 411
[dev:server] 💾 FASE 4: Salvataggio con logica Upsert nel database...
[dev:server] 💾 Inserimento/Aggiornamento di 52 clienti...
[dev:server] ✅ Clienti processati: 52 creati, 0 aggiornati.
[dev:server] 💾 Inserimento/Aggiornamento di 487 fornitori...
[dev:server] ✅ Fornitori processati: 487 creati, 0 aggiornati.
[dev:server] 💾 Inserimento/Aggiornamento di 52 clienti...
[dev:server] ✅ Clienti processati: 52 creati, 0 aggiornati.
[dev:server] 💾 Inserimento/Aggiornamento di 487 fornitori...
[dev:server] ✅ Fornitori processati: 487 creati, 0 aggiornati.
[dev:server] ✅ Clienti processati: 52 creati, 0 aggiornati.
[dev:server] 💾 Inserimento/Aggiornamento di 487 fornitori...
[dev:server] ✅ Fornitori processati: 487 creati, 0 aggiornati.
[dev:server] 💾 Inserimento/Aggiornamento di 487 fornitori...
[dev:server] ✅ Fornitori processati: 487 creati, 0 aggiornati.
[dev:server] ✅ Fornitori processati: 487 creati, 0 aggiornati.
[dev:server] ✅ Import anagrafiche completato con successo!
[dev:server] 📊 STATISTICHE FINALI:
[dev:server]    • Record processati: 526
[dev:server]    • Clienti creati: 52
[dev:server]    • Clienti aggiornati: 0
[dev:server]    • Fornitori creati: 487
[dev:server]    • Fornitori aggiornati: 0
[dev:server]
[dev:server] 📈 DETTAGLIO TIPOLOGIE:
[dev:server]    • Persone fisiche: 115
[dev:server]    • Società/Enti: 411
[dev:server]    • Con Partita IVA: 510
[dev:server]    • Soggetti a ritenuta: 0
[dev:server] ✅ Import anagrafiche completato con successo
[dev:server] [Recon V2] Richiesta ricevuta per scritture contabili da allocare
[dev:server] [Recon V2] Trovate 0 scritture con righe di costo.
[dev:server] [Recon V2] Richiesta ricevuta per scritture contabili da allocare
[dev:server] [Recon V2] Trovate 0 scritture con righe di costo.
[dev:server] [Recon V2] Richiesta ricevuta per scritture contabili da allocare
[dev:server] [Recon V2] Trovate 0 scritture con righe di costo.
[dev:server] 🔍 DEBUG HANDLER: Files ricevuti: 4
[dev:server] 🔍 DEBUG HANDLER: File "movanac" - 14385 bytes
[dev:server] 🔍 DEBUG HANDLER: File "pnrigcon" - 607220 bytes
[dev:server] 🔍 DEBUG HANDLER: File "pnrigiva" - 37584 bytes
[dev:server] 🔍 DEBUG HANDLER: File "pntesta" - 708700 bytes
[dev:server] 🚨 HANDLER: Eseguendo workflow...
[dev:server]
[dev:server] ================================================================================
[dev:server] 🚀 PARSER 6: SCRITTURE CONTABILI - Avvio Import Multi-File
[dev:server] ================================================================================
[dev:server] [2025-07-04T15:07:25.252Z] [INFO] [b0c31594-4a15-4e5b-aa87-2758cecd998c] Job import_scritture_contabili started { jobType: 'import_scritture_contabili', metadata:
 undefined }
[dev:server]
[dev:server] 📋 FASE 1: ACQUISIZIONE DATI
[dev:server] ──────────────────────────────────────────────────
[dev:server] 🔍 DEBUG: File ricevuti:
[dev:server]   - pnTesta: 708700 bytes
[dev:server]   - pnRigCon: 607220 bytes
[dev:server]   - pnRigIva: 37584 bytes
[dev:server]   - movAnac: 14385 bytes
[dev:server] [2025-07-04T15:07:25.253Z] [INFO] [b0c31594-4a15-4e5b-aa87-2758cecd998c] Iniziando parsing multi-file...
[dev:server] [2025-07-04T15:07:25.253Z] [INFO] [b0c31594-4a15-4e5b-aa87-2758cecd998c] Utilizzando definizioni di campo statiche dal codice.
[dev:server] [Parser] Parsing completato. 746 record estratti dal file.
[dev:server] [Parser] Parsing completato. 1940 record estratti dal file.
[dev:server] [Parser] Parsing completato. 216 record estratti dal file.
[dev:server] [Parser] Parsing completato. 411 record estratti dal file.
[dev:server] ✅ Parsing completato:
[dev:server]    📄 PNTESTA.TXT:    746 record (testate)
[dev:server]    📄 PNRIGCON.TXT:  1940 record (righe contabili)
[dev:server]    📄 PNRIGIVA.TXT:   216 record (righe IVA)
[dev:server]    📄 MOVANAC.TXT:    411 record (allocazioni)
[dev:server]    📊 TOTALE:        3313 record estratti
[dev:server]
[dev:server] 🔍 FASE 2: VALIDAZIONE E PULIZIA DATI
[dev:server] ──────────────────────────────────────────────────
[dev:server] [2025-07-04T15:07:25.290Z] [INFO] [b0c31594-4a15-4e5b-aa87-2758cecd998c] Iniziando validazione dati...
[dev:server] ✅ Validazione completata:
[dev:server]    ✓ Testate valide:         746 / 746
[dev:server]    ✓ Righe contabili valide: 1940 / 1940
[dev:server]    ✓ Righe IVA valide:       216 / 216
[dev:server]    ✓ Allocazioni valide:     411 / 411
[dev:server]    📊 TOTALE VALIDI:        3313 record
[dev:server]    ❌ Record scartati:          0 record (→ DLQ)
[dev:server]
[dev:server] 🔄 FASE 3: TRASFORMAZIONE BUSINESS LOGIC
[dev:server] ──────────────────────────────────────────────────
[dev:server] [2025-07-04T15:07:25.482Z] [INFO] [b0c31594-4a15-4e5b-aa87-2758cecd998c] Iniziando trasformazione business logic...
[dev:server] 🔧 Transformer COMPLETO: Creazione di TUTTE le entità...
[dev:server] 📋 Organizzando 746 testate...
[dev:server] ✅ Testate organizzate. Prime 5 chiavi: [
[dev:server]   '012025110001',
[dev:server]   '012025110002',
[dev:server]   '012025110003',
[dev:server]   '012025110004',
[dev:server]   '012025110005'
[dev:server] ]
[dev:server] 💰 Associando 1940 righe contabili...
[dev:server] ✅ 1940/1940 righe contabili associate
[dev:server] 📊 Associando 216 righe IVA...
[dev:server] ✅ 216/216 righe IVA associate
[dev:server] 🏭 Associando 411 allocazioni...
[dev:server] ✅ 411/411 allocazioni associate
[dev:server] 🔧 Creando tutte le entità Prisma...
[dev:server] ✅ Transformer COMPLETO: 746 scritture complete create
[dev:server]    📊 Righe contabili: 1940
[dev:server]    💰 Righe IVA: 216
[dev:server]    🏭 Allocazioni: 0
[dev:server] ✅ Trasformazione completata:
[dev:server]    📝 Scritture create:         746
[dev:server]    💰 Righe contabili create:  1940
[dev:server]    📊 Righe IVA create:         216
[dev:server]    🏭 Allocazioni create:         0
[dev:server]
[dev:server] 💾 FASE 4: PERSISTENZA ATOMICA
[dev:server] ──────────────────────────────────────────────────
[dev:server] [2025-07-04T15:07:25.561Z] [INFO] [b0c31594-4a15-4e5b-aa87-2758cecd998c] Iniziando persistenza con staging-commit...
[dev:server] [2025-07-04T15:07:25.561Z] [INFO] [b0c31594-4a15-4e5b-aa87-2758cecd998c] 💾 PERSISTENZA COMPLETA: Salvataggio di tutte le entità
[dev:server] [2025-07-04T15:07:25.614Z] [INFO] [b0c31594-4a15-4e5b-aa87-2758cecd998c] ✅ Cliente di sistema (cliente_sistema) assicurato.
[dev:server] [2025-07-04T15:07:25.614Z] [INFO] [b0c31594-4a15-4e5b-aa87-2758cecd998c] 🏢 Creazione 0 fornitori...
[dev:server] [2025-07-04T15:07:25.614Z] [INFO] [b0c31594-4a15-4e5b-aa87-2758cecd998c] 📋 Creazione 21 causali...
[dev:server] [2025-07-04T15:07:25.676Z] [INFO] [b0c31594-4a15-4e5b-aa87-2758cecd998c] 🏦 Creazione 143 conti...
[dev:server] [2025-07-04T15:07:26.082Z] [INFO] [b0c31594-4a15-4e5b-aa87-2758cecd998c] 📊 Creazione 25 codici IVA...
[dev:server] [2025-07-04T15:07:26.203Z] [INFO] [b0c31594-4a15-4e5b-aa87-2758cecd998c] 🏭 Creazione 0 commesse...
[dev:server] [2025-07-04T15:07:26.203Z] [INFO] [b0c31594-4a15-4e5b-aa87-2758cecd998c] 📈 Creazione 1 voci analitiche...
[dev:server] [2025-07-04T15:07:26.206Z] [INFO] [b0c31594-4a15-4e5b-aa87-2758cecd998c] 📝 Upsert 746 scritture contabili...
[dev:server] 
[dev:server] ❌ ERRORE DURANTE L'IMPORT
[dev:server] ================================================================================
[dev:server] 💥 Errore:
[dev:server] Invalid `tx.scritturaContabile.upsert()` invocation in
[dev:server] G:\HSC\Reale\commessa-control-hub\server\import-engine\orchestration\workflows\importScrittureContabiliWorkflow.ts:448:37
[dev:server]
[dev:server]   445 this.telemetryService.logInfo(jobId, `📝 Upsert ${transformResult.scritture.length} scritture contabili...`);
[dev:server]   446
[dev:server]   447 for (const scrittura of transformResult.scritture) {
[dev:server] → 448   await tx.scritturaContabile.upsert(
[dev:server] An operation failed because it depends on one or more records that were required but not found. No 'Fornitore' record(s) (needed to inline the relation on 'ScritturaContabile' record(s)) was found for a nested connect on one-to-many relation 'FornitoreToScritturaContabile'.
[dev:server] ⏱️  Durata parziale: 1019ms
[dev:server] 🔍 Job ID: b0c31594-4a15-4e5b-aa87-2758cecd998c
[dev:server] ================================================================================
[dev:server]
[dev:server] [2025-07-04T15:07:26.272Z] [ERROR] [b0c31594-4a15-4e5b-aa87-2758cecd998c] Job import_scritture_contabili failed {
[dev:server]   jobType: 'import_scritture_contabili',